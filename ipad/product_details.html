<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>product details</title>

    <!-- jQuery mobile files -->
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>


    <!-- Font awesome file -->
    <script src="https://kit.fontawesome.com/f083cf2118.js" crossorigin="anonymous"></script>

    <!-- Bootstrap CSS file -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom JS Files -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->

    <!-- Custom main CSS file -->
    <link rel="stylesheet" href="index.css">

</head>

<body class="post-login">
    <div data-role="page" class="productDetails">
        <div data-role="header" id="header" class="align-stuff">
            <div class="container">
                <div class="ui-grid-a">
                    <div class="ui-block-a w10">
                        <div class="ui-grid-a">
                            <div class="container">
                                <div class="ui-block-a w10">
                                    <a data-rel="back" rel="external"><img src="assets/img/back.svg" height="30"
                                            width="30"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-block-b icons w90">
                        <i id="favourite"></i>
                        <i class="fas fa-share-alt"></i>
                        <a class="primary-color-black-text" data-rel="popup" href="#overlay"
                            data-position-to="#optionz"><i class="fas fa-search"></i></a>
                        <div class="ui-content pt-0 mb-1" data-shadow="false" data-theme="none" data-overlay-theme="a"
                            data-role="popup" id="overlay">
                            <div class="deals-search-bar">
                                <ul data-role="listview" data-filter="true" data-filter-reveal="true"
                                    data-filter-placeholder="Searching Promotions" data-inset="true">
                                    <li><a class="dealsClick" accesskey="1">Winter Coffee Sale</a></li>
                                    <li><a class="dealsClick" accesskey="2">Google Pixel Sale</a></li>
                                    <li><a class="dealsClick" accesskey="3">Furniture Sale</a></li>
                                    <li><a class="dealsClick" accesskey="4">Electronic Christmas Sale</a></li>
                                </ul>
                            </div>
                        </div>
                        <a class="primary-color-black-text" href="realAR.html" rel="external"><i
                                class="fas fa-camera"></i></a>
                    </div>

                </div>
                <div class="ui-grid-a pl-4 mt-3">
                    <div class="ui-block-a w60 prod-deets">
                        <h3 id="productTitle">Stok Cold Brew Coffee - Med Caff</h3>
                        <div class="ui-grid-a">
                            <div class="ui-block-a w30">
                                <i class="fa fa-star secondary-color-yellow-text"></i>
                                <i class="fa fa-star secondary-color-yellow-text"></i>
                                <i class="fa fa-star secondary-color-yellow-text"></i>
                                <i class="fa fa-star secondary-color-yellow-text"></i>
                                <i class="fa fa-star-half-full secondary-color-yellow-text"></i>
                            </div>
                            <div class="ui-block-b w70">
                                <a href="reviews.html" rel="external">
                                    <p class="fw-bold f16">58 Reviews</p>
                                </a>
                            </div>
                        </div>
                        <p class="primary-color-grey-text f16 w80" id="productDetails">
                            Brewed from the heart of Kashmir, Stok presents the
                            best cold brew coffee of the 21st Century. This new line
                            of cold brews gives twice the motivation and energy
                            while keeping the nostalgic taste everybody loves...
                        </p>
                        <div class="ui-grid-a pt-3">
                            <div class="ui-block-a w20">
                                <p class="primary-color-grey-text f22 mt-2"><strike>20.99</strike></p>
                            </div>
                            <div class="ui-block-b">
                                <h3 class="primary-color-red-text"><b>USD<span
                                            style="font-size: 32px; padding-left: 7px" id="price">10.99</span></b>
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="ui-block-b w40">
                        <div class="text-center">
                            <img class="img-fluid text-center pt-4" src="assets/img/product.png" id="image">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div data-role="main" class="align-stuff">
            <div class="container">
                <div class="ui-grid-a">
                    <div class="ui-block-a pt-5 pl-4 mt-2 d-none hideInStore">
                        <div class="ui-grid-b counter pb-2 my-auto w45">
                            <div class="ui-block-a minusCount">
                                <i class="fas fa-minus box-shadow-default"></i>
                            </div>
                            <div class="ui-block-b">
                                <p class="count">1</p>
                            </div>
                            <div class="ui-block-c plusCount">
                                <i class="fas fa-plus box-shadow-default"></i>
                            </div>
                        </div>
                    </div>
                    <div class="ui-block-b pt-5 pr-3">
                        <div class="ui-grid-a d-none hideInStore">
                            <div class="ui-block-a ">
                                <a id="added" class="ui-btn btn secondary-btn w90 pathUrl" accesskey="nope">ADD TO CART</a>

                                <div style="background-color: #F6FAFF; text-shadow: none; border: none;"
                                    data-role="popup" data-position-to="window" id="addedPop" class="ui-content">
                                    <div class="cart-popup">
                                        <div class="container">
                                            <div class="text-center">
                                                <img src="assets/img/success.png" width="250" alt="">
                                                <h3 class="secondary-color f28">Success</h3>
                                                <h6 style="font-weight: 500;" class="primary-color-grey-text f22">Your
                                                    item has been added to
                                                    the
                                                    cart!</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ui-block-b">
                                <a rel="external" class="ui-btn btn primary-btn mb-3 w90 pathUrl"
                                    accesskey="proceed">BUY NOW</a>
                            </div>
                        </div>
                        <div class="ui-grid-solo d-none showInStore">
                            <div class="ui-block-a">
                                <a rel="external" class="ui-btn btn primary-btn mb-3 w90 pathUrl"
                                    accesskey="map.html">View Store Location</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div data-role="footer" data-position="fixed" id="footer" data-tap-toggle="false" transition="fade"
            class="py-2">
            <div data-role="navbar" data-grid="d" class="h90 text-center footer">
                <ul class="h100">
                    <li class="w100 h20 nav-footer">
                        <a href="home.html" rel="external">
                            <i class="fa fa-home"></i>
                            <div>Home</div>
                        </a>
                    </li>
                    <li class="w100 h20 nav-footer">
                        <a href="deals.html" rel="external" class="active">
                            <i class="fa fa-tag font"></i>
                            <div>Deals</div>
                        </a>
                    </li>
                    <li class="w100 h20 nav-footer">
                        <a href="#" rel="external">
                            <i class="fa fa-store-alt"></i>
                            <div>Store</div>
                        </a>
                    </li>
                    <li class="w100 h20 nav-footer">
                        <a href="cart.html" rel="external">
                            <i class="fa fa-shopping-cart"></i>
                            <div>Cart</div>
                        </a>
                    </li>
                    <li class="w100 h20 nav-footer">
                        <a href="profile.html" rel="external">
                            <i class="fa fa-user"></i>
                            <div>Profile</div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div data-role="footer" data-position="fixed" id="footer2" data-tap-toggle="false" transition="fade">
            <div data-role="navbar" data-grid="d" class="text-center footer2">
                <ul class="w100">
                    <li class="w20 nav-footer">
                        <a href="home.html" rel="external">
                            <i class="fa fa-home"></i>
                            <div>Home</div>
                        </a>
                    </li>
                    <li class="w20 nav-footer">
                        <a href="deals.html" rel="external">
                            <i class="fa fa-tag font"></i>
                            <div>Deals</div>
                        </a>
                    </li>
                    <li class="w20 nav-footer">
                        <a href="#" rel="external">
                            <i class="fa fa-store-alt"></i>
                            <div>Store</div>
                        </a>
                    </li>
                    <li class="w20 nav-footer">
                        <a href="cart.html" rel="external" class="active">
                            <i class="fa fa-shopping-cart"></i>
                            <div>Cart</div>
                        </a>
                    </li>
                    <li class="w20 nav-footer">
                        <a href="profile.html" rel="external">
                            <i class="fa fa-user"></i>
                            <div>Profile</div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {

            $("#added").on("click", function () {
                $("#addedPop").popup("open");
                setTimeout(function () {
                    $("#addedPop").popup("close");
                }, 2000);
            });

            if (sessionStorage.getItem("currentDeal") === "2") {
                $(".showInStore").removeClass("d-none");

            } else {
                $(".hideInStore").removeClass("d-none");
            }


            $(document).on("click", ".dealsClick", function () {
                sessionStorage.setItem("currentDeal", this.accessKey);
                sessionStorage.setItem("ratingFilter", '0');
                sessionStorage.setItem("priceFilter", '{"startValue":"0","EndValue":"999"}');
                sessionStorage.setItem("sort", 'default');
                document.location.href = 'promotion_details.html';
            });
            quantity = 1;
            var thisimage;
            var prodId;

            $.post("backend/singleProduct.php", {
                currentProduct: sessionStorage.getItem("currentProduct")
            }, function (data, status) {
                data = JSON.parse(data);
                $.each(data, function (i, v) {
                    prodId = v.id;
                    thisimage = v.image;
                    $('#productTitle').text(v.name);
                    $('#productDetails').text(v.details);
                    $('#price').text(' ' + v.price);
                    $("#image").attr("src", v.image);
                });
            });

            $(".count").text("1");


            $(".plusCount").bind("click", function (event, ui) {
                quantity += 1;
                $(".count").text(quantity.toString());
            });

            $(".minusCount").bind("click", function (event, ui) {
                quantity -= 1;
                if (parseInt(quantity) > 0) {
                    $(".count").text(quantity.toString());
                } else {
                    quantity = 1;
                    $(".count").text(quantity.toString());
                }
            });
            var alreadyCart = false;
            var index;
            $(".pathUrl").click(function () {
                if (sessionStorage.getItem("currentDeal") === "2") {
                    document.location.href = this.accessKey;
                }
                var currentCart = JSON.parse(sessionStorage.getItem('cart'));
                $.each(currentCart['items'], function (i, item) {
                    if (item['id'] === prodId) {
                        alreadyCart = true;
                        index = i;
                        return false;
                    }
                });
                if (alreadyCart) {
                    currentCart['total'] = (parseFloat(currentCart['total']) - (parseFloat(currentCart[
                        'items'][index]['amount']) * parseFloat(currentCart['items'][index][
                        'price'
                    ]))).toFixed(2);
                    currentCart['items'][index]['amount'] = quantity;
                    currentCart['total'] = (parseFloat(currentCart['total']) + (parseFloat(currentCart[
                        'items'][index]['amount']) * parseFloat(currentCart['items'][index][
                        'price'
                    ]))).toFixed(2);
                    sessionStorage.setItem('cart', JSON.stringify(currentCart));
                } else {
                    var thisItem = {};
                    thisItem['image'] = thisimage;
                    thisItem['id'] = prodId;
                    thisItem['name'] = $('#productTitle').text();
                    thisItem['price'] = $('#price').text();
                    thisItem['amount'] = quantity;
                    currentCart['total'] = (parseFloat(currentCart['total']) + (parseFloat(thisItem[
                        'amount']) * parseFloat(thisItem['price']))).toFixed(2);
                    currentCart['items'].push(thisItem);
                    sessionStorage.setItem('cart', JSON.stringify(currentCart));
                }

                if (this.accessKey === 'proceed') {
                    document.location.href = "cart.html";
                } else if (this.accessKey === 'reviews') {
                    document.location.href = "reviews.html";
                } else {

                }

            });
            $.post("backend/userData.php", {
                action: 'view',
                currentUser: sessionStorage.getItem("loggedUser")
            }, function (data, status) {
                const json = JSON.parse(data);
                const favArray = json.favoriteList;
                const parseProductNo = parseInt(sessionStorage.getItem("currentProduct"));
                if (jQuery.inArray(parseProductNo, favArray) !== -1) {
                    const heart = `fas fa-heart primary-color-red-text pointer removeClick`;
                    $("#favourite").addClass(heart);

                } else {
                    const heart = `far fa-heart pointer addClick`;
                    $("#favourite").addClass(heart);
                }

            });
            $(document).on("click", ".addClick", function () {
                const that = this;
                $.post("backend/favourite.php", {
                    action: 'add',
                    currentUser: sessionStorage.getItem("loggedUser"),
                    prodId: sessionStorage.getItem("currentProduct")
                }, function (data, status) {
                    $(that).removeClass('far fa-heart pointer addClick');
                    $(that).addClass('fas fa-heart primary-color-red-text pointer removeClick');
                });
            });
            $(document).on("click", ".removeClick", function () {
                const that = this;
                $.post("backend/favourite.php", {
                    action: 'remove',
                    currentUser: sessionStorage.getItem("loggedUser"),
                    prodId: sessionStorage.getItem("currentProduct")
                }, function (data, status) {
                    $(that).removeClass(
                        'fas fa-heart primary-color-red-text pointer removeClick');
                    $(that).addClass('far fa-heart pointer addClick');
                });
            });
        })
    </script>
</body>

</html>